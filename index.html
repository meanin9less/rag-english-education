<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ì–´ ë¬¸ì œ ìƒì„± ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .form-container {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .category-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .category-header h3 {
            color: #333;
            font-size: 1.3rem;
        }

        .add-category-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .add-category-btn:hover {
            background: #218838;
        }

        .category-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
        }

        .category-controls {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 15px;
            align-items: end;
        }

        .subcategory-group {
            margin-top: 15px;
        }

        .subcategory-checkboxes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
            padding: 15px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .subcategory-checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px;
            border-radius: 5px;
            transition: background 0.2s ease;
        }

        .subcategory-checkbox-item:hover {
            background: #f8f9fa;
        }

        .subcategory-checkbox {
            width: 16px;
            height: 16px;
            accent-color: #4facfe;
        }

        .subcategory-label {
            font-size: 0.9rem;
            cursor: pointer;
            user-select: none;
        }

        .selected-subcategories {
            margin-top: 10px;
        }

        .selected-count {
            background: #4facfe;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .subcategory-loading {
            padding: 15px;
            text-align: center;
            color: #666;
            font-size: 0.9rem;
        }

        .subcategory-placeholder {
            padding: 15px;
            text-align: center;
            background: #f8f9fa;
            border: 1px dashed #dee2e6;
            border-radius: 8px;
            margin-top: 10px;
        }

        .difficulty-section {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .difficulty-distribution {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .difficulty-item {
            text-align: center;
        }

        .difficulty-item label {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .difficulty-input {
            text-align: center;
            font-weight: bold;
        }

        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .generate-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .result-section {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4facfe;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .result-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #dee2e6;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-title {
            color: #4facfe;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .json-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .category-controls {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .difficulty-distribution {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ ì˜ì–´ ë¬¸ì œ ìƒì„± ì‹œìŠ¤í…œ</h1>
            <p>AI ê¸°ë°˜ ë§ì¶¤í˜• ì˜ì–´ í•™ìŠµ ì½˜í…ì¸  ìƒì„± ë„êµ¬</p>
        </div>

        <div class="form-container">
            <form id="contentForm">
                <!-- ê¸°ë³¸ ì„¤ì • -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="grade">í•™ë…„</label>
                        <select id="grade" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="1">1í•™ë…„</option>
                            <option value="2">2í•™ë…„</option>
                            <option value="3">3í•™ë…„</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="questionType">ë¬¸ì œ ìœ í˜•</label>
                        <select id="questionType" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ê°ê´€ì‹">ê°ê´€ì‹</option>
                            <option value="ì£¼ê´€ì‹">ì£¼ê´€ì‹</option>
                            <option value="ì„œìˆ í˜•">ì„œìˆ í˜•</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="difficulty">ë‚œì´ë„</label>
                        <select id="difficulty" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ìƒ">ìƒ</option>
                            <option value="ì¤‘">ì¤‘</option>
                            <option value="í•˜">í•˜</option>
                            <option value="ë¶„ë°°">ë¶„ë°°</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="totalQuestions">ì´ ë¬¸í•­ ìˆ˜</label>
                        <input type="number" id="totalQuestions" min="5" max="50" value="10" required>
                    </div>
                </div>

                <!-- ë‚œì´ë„ ë¶„ë°° ì„¤ì • -->
                <div class="difficulty-section" id="difficultyDistribution" style="display: none;">
                    <h3>ğŸ¯ ë‚œì´ë„ ë¶„ë°° ì„¤ì •</h3>
                    <div class="difficulty-distribution">
                        <div class="difficulty-item">
                            <label>ìƒ (%)</label>
                            <input type="number" class="difficulty-input" id="diffHigh" min="0" max="100" value="20">
                        </div>
                        <div class="difficulty-item">
                            <label>ì¤‘ (%)</label>
                            <input type="number" class="difficulty-input" id="diffMedium" min="0" max="100" value="60">
                        </div>
                        <div class="difficulty-item">
                            <label>í•˜ (%)</label>
                            <input type="number" class="difficulty-input" id="diffLow" min="0" max="100" value="20">
                        </div>
                    </div>
                </div>

                <!-- ì¹´í…Œê³ ë¦¬ ì„¤ì • -->
                <div class="category-section">
                    <div class="category-header">
                        <h3>ğŸ“š ì¹´í…Œê³ ë¦¬ ì„¤ì •</h3>
                        <button type="button" class="add-category-btn" onclick="addCategory()">+ ì¹´í…Œê³ ë¦¬ ì¶”ê°€</button>
                    </div>
                    <div id="categoriesContainer">
                        <!-- ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ -->
                        <div class="category-item">
                            <div class="category-controls">
                <div class="form-group">
                    <label>ì¹´í…Œê³ ë¦¬ (ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥)</label>
                                    <select class="category-select" required>
                                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                        <option value="ë…í•´">ë…í•´</option>
                                        <option value="ë¬¸ë²•">ë¬¸ë²•</option>
                                        <option value="ì–´íœ˜">ì–´íœ˜</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>ë¹„ìœ¨ (%)</label>
                                    <input type="number" class="ratio-input" min="1" max="100" value="50" required>
                                </div>
                                <div class="form-group">
                                    <button type="button" class="add-category-btn" style="background: #dc3545;" onclick="removeCategory(this)">ì‚­ì œ</button>
                                </div>
                            </div>
                            <div class="subcategory-group">
                                <label>ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ ì„ íƒ</label>
                                <div class="subcategory-loading" style="display: none;">
                                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px;">
                                        <div style="width: 20px; height: 20px; border: 2px solid #f3f3f3; border-top: 2px solid #4facfe; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                                        <span>ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
                                    </div>
                                </div>
                                <div class="subcategory-checkboxes" style="display: none;">
                                    <!-- ì²´í¬ë°•ìŠ¤ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                                </div>
                                <div class="subcategory-placeholder">
                                    <p style="color: #666; font-style: italic; padding: 10px;">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ë©´ ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
                                </div>
                                <div class="selected-subcategories">
                                    <span class="selected-count" style="display: none;">ì„ íƒë¨: 0ê°œ</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="generate-btn">ğŸš€ ì˜ì–´ ë¬¸ì œ ìƒì„±í•˜ê¸°</button>
            </form>

            <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
            <div class="result-section" id="resultSection">
                <div class="loading" id="loadingDiv">
                    <div class="spinner"></div>
                    <h3>AIê°€ ë§ì¶¤í˜• ì˜ì–´ ë¬¸ì œë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</h3>
                    <p>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”. ì•½ 1-2ë¶„ ì†Œìš”ë©ë‹ˆë‹¤.</p>
                </div>
                <div class="result-content" id="resultContent" style="display: none;">
                    <!-- ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // DBì—ì„œ ê°€ì ¸ì˜¨ ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ ì˜µì…˜ (ì‹¤ì œë¡œëŠ” API í˜¸ì¶œë¡œ ê°€ì ¸ì˜´)
        const subcategoryOptions = {
            'ë…í•´': [
                'ì£¼ì œ/ì œëª© ì¶”ë¡ ', 'ìš”ì§€/ì£¼ì¥ íŒŒì•…', 'ì„¸ë¶€ì‚¬í•­ íŒŒì•…', 'ë¹ˆì¹¸ ì¶”ë¡ ', 
                'ë¬¸ë‹¨ ìˆœì„œ', 'ë¬¸ì¥ ì‚½ì…', 'ë‚´ìš© ì¼ì¹˜/ë¶ˆì¼ì¹˜', 'ê¸€ì˜ ë¶„ìœ„ê¸°/ì–´ì¡°',
                'í•¨ì¶• ì˜ë¯¸ ì¶”ë¡ ', 'ì—°ê²°ì–´êµ¬ ì¶”ë¡ ', 'ë¬¸ë§¥ìƒ ì–´ë²•'
            ],
            'ë¬¸ë²•': [
                'ì‹œì œ', 'íƒœ', 'ì¡°ë™ì‚¬', 'toë¶€ì •ì‚¬', 'ë™ëª…ì‚¬', 'ë¶„ì‚¬', 
                'ê´€ê³„ì‚¬', 'ê°€ì •ë²•', 'ë¹„êµêµ¬ë¬¸', 'ì ‘ì†ì‚¬', 'ì „ì¹˜ì‚¬', 
                'í’ˆì‚¬ ë° ì–´ë²•', 'ë„ì¹˜', 'ìƒëµ', 'ê°•ì¡°êµ¬ë¬¸'
            ],
            'ì–´íœ˜': [
                'ë‹¨ì–´ì˜ ì˜ë¯¸', 'ë¬¸ë§¥ìƒ ì ì ˆí•œ ì–´íœ˜', 'ì–´íœ˜ ì¶”ë¡ ', 
                'ìˆ™ì–´/ê´€ìš©í‘œí˜„', 'ì–´ê·¼/ì ‘ì‚¬', 'ë™ì˜ì–´/ë°˜ì˜ì–´',
                'ë‹¤ì˜ì–´', 'í˜•íƒœ ë³€í™”', 'ì–´íœ˜ ë°°ì—´'
            ]
        };

        // DB ì‹œë®¬ë ˆì´ì…˜ - ì‹¤ì œë¡œëŠ” ë°±ì—”ë“œ API í˜¸ì¶œ
        async function fetchSubcategoriesFromDB(category) {
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì´ ë¶€ë¶„ì´ API í˜¸ì¶œ
            // const response = await fetch(`/api/subcategories/${category}`);
            // return await response.json();
            
            // ì‹œë®¬ë ˆì´ì…˜: ì•½ê°„ì˜ ì§€ì—° í›„ ë°ì´í„° ë°˜í™˜
            return new Promise(resolve => {
                setTimeout(() => {
                    resolve(subcategoryOptions[category] || []);
                }, 300);
            });
        }

        // ë‚œì´ë„ ì„ íƒ ë³€ê²½ ì´ë²¤íŠ¸
        document.getElementById('difficulty').addEventListener('change', function() {
            const difficultyDistribution = document.getElementById('difficultyDistribution');
            if (this.value === 'ë¶„ë°°') {
                difficultyDistribution.style.display = 'block';
            } else {
                difficultyDistribution.style.display = 'none';
            }
        });

        // ì¹´í…Œê³ ë¦¬ ì¶”ê°€ í•¨ìˆ˜
        function addCategory() {
            const container = document.getElementById('categoriesContainer');
            const categoryItem = document.createElement('div');
            categoryItem.className = 'category-item';
            categoryItem.innerHTML = `
                <div class="category-controls">
                    <div class="form-group">
                        <label>ì¹´í…Œê³ ë¦¬ (ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥)</label>
                        <select class="category-select" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ë…í•´">ë…í•´</option>
                            <option value="ë¬¸ë²•">ë¬¸ë²•</option>
                            <option value="ì–´íœ˜">ì–´íœ˜</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ë¹„ìœ¨ (%)</label>
                        <input type="number" class="ratio-input" min="1" max="100" value="30" required>
                    </div>
                    <div class="form-group">
                        <button type="button" class="add-category-btn" style="background: #dc3545;" onclick="removeCategory(this)">ì‚­ì œ</button>
                    </div>
                </div>
                <div class="subcategory-group">
                    <label>ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ ì„ íƒ</label>
                    <div class="subcategory-loading" style="display: none;">
                        <div style="display: flex; align-items: center; gap: 10px; padding: 10px;">
                            <div style="width: 20px; height: 20px; border: 2px solid #f3f3f3; border-top: 2px solid #4facfe; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                            <span>ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
                        </div>
                    </div>
                    <div class="subcategory-checkboxes" style="display: none;">
                        <!-- ì²´í¬ë°•ìŠ¤ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                    <div class="subcategory-placeholder">
                        <p style="color: #666; font-style: italic; padding: 10px;">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ë©´ ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                    <div class="selected-subcategories">
                        <span class="selected-count" style="display: none;">ì„ íƒë¨: 0ê°œ</span>
                    </div>
                </div>
            `;
            container.appendChild(categoryItem);
            setupCategoryEvents(categoryItem);
        }

        // ì¹´í…Œê³ ë¦¬ ì‚­ì œ í•¨ìˆ˜
        function removeCategory(button) {
            button.closest('.category-item').remove();
        }

        // ì¹´í…Œê³ ë¦¬ ì´ë²¤íŠ¸ ì„¤ì •
        function setupCategoryEvents(categoryItem) {
            const categorySelect = categoryItem.querySelector('.category-select');
            const subcategoryLoading = categoryItem.querySelector('.subcategory-loading');
            const subcategoryCheckboxes = categoryItem.querySelector('.subcategory-checkboxes');
            const subcategoryPlaceholder = categoryItem.querySelector('.subcategory-placeholder');
            const selectedCount = categoryItem.querySelector('.selected-count');

            // ì¹´í…Œê³ ë¦¬ ì„ íƒ ë³€ê²½ ì‹œ DBì—ì„œ ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ ë¡œë“œ
            categorySelect.addEventListener('change', async function() {
                const category = this.value;
                
                if (!category) {
                    // ì¹´í…Œê³ ë¦¬ ì„ íƒ í•´ì œ
                    subcategoryCheckboxes.style.display = 'none';
                    subcategoryPlaceholder.style.display = 'block';
                    selectedCount.style.display = 'none';
                    return;
                }

                // ë¡œë”© í‘œì‹œ
                subcategoryPlaceholder.style.display = 'none';
                subcategoryLoading.style.display = 'block';
                subcategoryCheckboxes.style.display = 'none';

                try {
                    // DBì—ì„œ ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ ê°€ì ¸ì˜¤ê¸°
                    const subcategories = await fetchSubcategoriesFromDB(category);
                    
                    // ì²´í¬ë°•ìŠ¤ ìƒì„±
                    createSubcategoryCheckboxes(subcategoryCheckboxes, subcategories, selectedCount);
                    
                    // ë¡œë”© ìˆ¨ê¸°ê³  ì²´í¬ë°•ìŠ¤ í‘œì‹œ
                    subcategoryLoading.style.display = 'none';
                    subcategoryCheckboxes.style.display = 'grid';
                    selectedCount.style.display = 'inline-block';
                    
                } catch (error) {
                    console.error('ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì‹¤íŒ¨:', error);
                    subcategoryLoading.style.display = 'none';
                    subcategoryPlaceholder.innerHTML = '<p style="color: #dc3545;">ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
                    subcategoryPlaceholder.style.display = 'block';
                }
            });
        }

        // ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ ì²´í¬ë°•ìŠ¤ ìƒì„±
        function createSubcategoryCheckboxes(container, subcategories, selectedCount) {
            container.innerHTML = '';
            
            subcategories.forEach((subcategory, index) => {
                const checkboxItem = document.createElement('div');
                checkboxItem.className = 'subcategory-checkbox-item';
                
                const checkboxId = `subcategory_${Date.now()}_${index}`;
                
                checkboxItem.innerHTML = `
                    <input type="checkbox" id="${checkboxId}" class="subcategory-checkbox" value="${subcategory}">
                    <label for="${checkboxId}" class="subcategory-label">${subcategory}</label>
                `;
                
                container.appendChild(checkboxItem);
                
                // ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì´ë²¤íŠ¸
                const checkbox = checkboxItem.querySelector('.subcategory-checkbox');
                checkbox.addEventListener('change', function() {
                    updateSelectedCount(container.closest('.category-item'));
                });
            });
            
            updateSelectedCount(container.closest('.category-item'));
        }

        // ì„ íƒëœ ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ ìˆ˜ ì—…ë°ì´íŠ¸
        function updateSelectedCount(categoryItem) {
            const checkboxes = categoryItem.querySelectorAll('.subcategory-checkbox');
            const selectedCheckboxes = categoryItem.querySelectorAll('.subcategory-checkbox:checked');
            const selectedCount = categoryItem.querySelector('.selected-count');
            
            const count = selectedCheckboxes.length;
            selectedCount.textContent = `ì„ íƒë¨: ${count}ê°œ`;
            selectedCount.style.backgroundColor = count > 0 ? '#28a745' : '#6c757d';
        }

        // ì„ íƒëœ ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ ê°€ì ¸ì˜¤ê¸°
        function getSelectedSubcategories(categoryItem) {
            const selectedCheckboxes = categoryItem.querySelectorAll('.subcategory-checkbox:checked');
            return Array.from(selectedCheckboxes).map(cb => cb.value);
        }

        // ì´ˆê¸° ì¹´í…Œê³ ë¦¬ ì´ë²¤íŠ¸ ì„¤ì •
        document.querySelectorAll('.category-item').forEach(setupCategoryEvents);

        // í¼ ì œì¶œ ì´ë²¤íŠ¸
        document.getElementById('contentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // í¼ ë°ì´í„° ìˆ˜ì§‘
            const formData = collectFormData();
            
            if (formData) {
                // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
                document.getElementById('resultSection').style.display = 'block';
                document.getElementById('loadingDiv').style.display = 'block';
                document.getElementById('resultContent').style.display = 'none';
                
                // ìŠ¤í¬ë¡¤ ì´ë™
                document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
                
                // ì‹¤ì œë¡œëŠ” ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ì•¼ í•˜ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ì‹œë®¬ë ˆì´ì…˜
                simulateGeneration(formData);
            }
        });

        // í¼ ë°ì´í„° ìˆ˜ì§‘
        function collectFormData() {
            const categories = [];
            const categoryItems = document.querySelectorAll('.category-item');
            
            let totalRatio = 0;
            
            for (let item of categoryItems) {
                const categorySelect = item.querySelector('.category-select');
                const ratioInput = item.querySelector('.ratio-input');
                
                if (!categorySelect.value) {
                    alert('ëª¨ë“  ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return null;
                }
                
                // ì„ íƒëœ ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ ê°€ì ¸ì˜¤ê¸°
                const selectedSubcategories = getSelectedSubcategories(item);
                
                if (selectedSubcategories.length === 0) {
                    alert(`${categorySelect.value} ì¹´í…Œê³ ë¦¬ì— ìµœì†Œ 1ê°œì˜ ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.`);
                    return null;
                }
                
                const ratio = parseInt(ratioInput.value);
                totalRatio += ratio;
                
                categories.push({
                    name: categorySelect.value,
                    subcategories: selectedSubcategories,
                    ratio: ratio
                });
            }
            
            if (totalRatio !== 100) {
                alert(`ì¹´í…Œê³ ë¦¬ ë¹„ìœ¨ì˜ í•©ì´ 100%ê°€ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. (í˜„ì¬: ${totalRatio}%)`);
                return null;
            }
            
            const formData = {
                grade: parseInt(document.getElementById('grade').value),
                categories: categories,
                question_type: document.getElementById('questionType').value,
                difficulty: document.getElementById('difficulty').value,
                total_questions: parseInt(document.getElementById('totalQuestions').value)
            };
            
            if (formData.difficulty === 'ë¶„ë°°') {
                const high = parseInt(document.getElementById('diffHigh').value);
                const medium = parseInt(document.getElementById('diffMedium').value);
                const low = parseInt(document.getElementById('diffLow').value);
                
                if (high + medium + low !== 100) {
                    alert(`ë‚œì´ë„ ë¶„ë°°ì˜ í•©ì´ 100%ê°€ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. (í˜„ì¬: ${high + medium + low}%)`);
                    return null;
                }
                
                formData.difficulty_distribution = {
                    high: high,
                    medium: medium,
                    low: low
                };
            }
            
            return formData;
        }

        // ìƒì„± ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œë¡œëŠ” ì„œë²„ API í˜¸ì¶œ)
        function simulateGeneration(formData) {
            console.log('Generated request data:', formData);
            
            // ì‹œë®¬ë ˆì´ì…˜ ì§€ì—°
            setTimeout(() => {
                document.getElementById('loadingDiv').style.display = 'none';
                document.getElementById('resultContent').style.display = 'block';
                
                // ê²°ê³¼ í‘œì‹œ
                displayResults(formData);
            }, 3000);
        }

        // ê²°ê³¼ í‘œì‹œ
        function displayResults(formData) {
            const resultContent = document.getElementById('resultContent');
            
            resultContent.innerHTML = `
                <div class="result-item">
                    <div class="result-title">ğŸ“‹ ìš”ì²­ ë°ì´í„°</div>
                    <div class="json-display">${JSON.stringify(formData, null, 2)}</div>
                </div>
                
                <div class="result-item">
                    <div class="result-title">ğŸ“Š ë¬¸í•­ ë¶„ë°° ê³„íš</div>
                    <div class="json-display">${generateDistributionPlan(formData)}</div>
                </div>
                
                <div class="result-item">
                    <div class="result-title">ğŸš€ ìƒì„± ìƒíƒœ</div>
                    <p>âœ… ìš”ì²­ ë°ì´í„° ê²€ì¦ ì™„ë£Œ</p>
                    <p>âœ… ë¬¸í•­ ë¶„ë°° ê³„íš ìˆ˜ë¦½ ì™„ë£Œ</p>
                    <p>â³ ì‹¤ì œ ì½˜í…ì¸  ìƒì„±ì„ ìœ„í•´ì„œëŠ” Python ë°±ì—”ë“œ ì„œë²„ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
                    <p>ğŸ’¡ ì´ HTMLì€ ìš”ì²­ ë°ì´í„° êµ¬ì¡°ë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ í”„ë¡ íŠ¸ì—”ë“œ ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.</p>
                </div>
            `;
        }

        // ë¶„ë°° ê³„íš ìƒì„±
        function generateDistributionPlan(formData) {
            let plan = "ë¬¸í•­ ë¶„ë°° ê³„íš:\n\n";
            
            const totalRatio = formData.categories.reduce((sum, cat) => sum + cat.ratio, 0);
            
            formData.categories.forEach(category => {
                const categoryQuestions = Math.floor(formData.total_questions * category.ratio / totalRatio);
                const subcategoryQuestions = Math.floor(categoryQuestions / category.subcategories.length);
                
                plan += `${category.name} (${category.ratio}%): ${categoryQuestions}ë¬¸í•­\n`;
                
                category.subcategories.forEach(sub => {
                    plan += `  â”” ${sub}: ${subcategoryQuestions}ë¬¸í•­\n`;
                });
                
                plan += "\n";
            });
            
            if (formData.difficulty === 'ë¶„ë°°') {
                plan += "ë‚œì´ë„ ë¶„ë°°:\n";
                plan += `  ìƒ: ${formData.difficulty_distribution.high}%\n`;
                plan += `  ì¤‘: ${formData.difficulty_distribution.medium}%\n`;
                plan += `  í•˜: ${formData.difficulty_distribution.low}%\n`;
            }
            
            return plan;
        }
    </script>
</body>
</html>
