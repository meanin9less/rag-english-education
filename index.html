<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏòÅÏñ¥ Î¨∏Ï†ú ÏÉùÏÑ± ÏãúÏä§ÌÖú</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .form-container {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .category-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .category-header h3 {
            color: #333;
            font-size: 1.3rem;
        }

        .add-category-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .add-category-btn:hover {
            background: #218838;
        }

        .category-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
        }

        .category-controls {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 15px;
            align-items: end;
        }

        .subcategory-group {
            margin-top: 15px;
        }

        .subcategory-checkboxes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
            padding: 15px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .subcategory-checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px;
            border-radius: 5px;
            transition: background 0.2s ease;
        }

        .subcategory-checkbox-item:hover {
            background: #f8f9fa;
        }

        .subcategory-checkbox {
            width: 16px;
            height: 16px;
            accent-color: #4facfe;
        }

        .subcategory-label {
            font-size: 0.9rem;
            cursor: pointer;
            user-select: none;
        }

        .selected-subcategories {
            margin-top: 10px;
        }

        .selected-count {
            background: #4facfe;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .subcategory-loading {
            padding: 15px;
            text-align: center;
            color: #666;
            font-size: 0.9rem;
        }

        .subcategory-placeholder {
            padding: 15px;
            text-align: center;
            background: #f8f9fa;
            border: 1px dashed #dee2e6;
            border-radius: 8px;
            margin-top: 10px;
        }

        .difficulty-section {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .difficulty-distribution {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .difficulty-item {
            text-align: center;
        }

        .difficulty-item label {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .difficulty-input {
            text-align: center;
            font-weight: bold;
        }

        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .generate-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .result-section {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4facfe;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .result-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #dee2e6;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-title {
            color: #4facfe;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .json-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .category-controls {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .difficulty-distribution {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì ÏòÅÏñ¥ Î¨∏Ï†ú ÏÉùÏÑ± ÏãúÏä§ÌÖú</h1>
            <p>AI Í∏∞Î∞ò ÎßûÏ∂§Ìòï ÏòÅÏñ¥ ÌïôÏäµ ÏΩòÌÖêÏ∏† ÏÉùÏÑ± ÎèÑÍµ¨</p>
        </div>

        <div class="form-container">
            <form id="contentForm">
                <!-- Í∏∞Î≥∏ ÏÑ§Ï†ï -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="grade">ÌïôÎÖÑ</label>
                        <select id="grade" required>
                            <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                            <option value="1">1ÌïôÎÖÑ</option>
                            <option value="2">2ÌïôÎÖÑ</option>
                            <option value="3">3ÌïôÎÖÑ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="questionType">Î¨∏Ï†ú Ïú†Ìòï</label>
                        <select id="questionType" required>
                            <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                            <option value="Í∞ùÍ¥ÄÏãù">Í∞ùÍ¥ÄÏãù</option>
                            <option value="Ï£ºÍ¥ÄÏãù">Ï£ºÍ¥ÄÏãù</option>
                            <option value="ÏÑúÏà†Ìòï">ÏÑúÏà†Ìòï</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="difficulty">ÎÇúÏù¥ÎèÑ</label>
                        <select id="difficulty" required>
                            <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                            <option value="ÏÉÅ">ÏÉÅ</option>
                            <option value="Ï§ë">Ï§ë</option>
                            <option value="Ìïò">Ìïò</option>
                            <option value="Î∂ÑÎ∞∞">Î∂ÑÎ∞∞</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="totalQuestions">Ï¥ù Î¨∏Ìï≠ Ïàò</label>
                        <input type="number" id="totalQuestions" min="5" max="50" value="10" required>
                    </div>
                </div>

                <!-- ÎÇúÏù¥ÎèÑ Î∂ÑÎ∞∞ ÏÑ§Ï†ï -->
                <div class="difficulty-section" id="difficultyDistribution" style="display: none;">
                    <h3>üéØ ÎÇúÏù¥ÎèÑ Î∂ÑÎ∞∞ ÏÑ§Ï†ï</h3>
                    <div class="difficulty-distribution">
                        <div class="difficulty-item">
                            <label>ÏÉÅ (%)</label>
                            <input type="number" class="difficulty-input" id="diffHigh" min="0" max="100" value="20">
                        </div>
                        <div class="difficulty-item">
                            <label>Ï§ë (%)</label>
                            <input type="number" class="difficulty-input" id="diffMedium" min="0" max="100" value="60">
                        </div>
                        <div class="difficulty-item">
                            <label>Ìïò (%)</label>
                            <input type="number" class="difficulty-input" id="diffLow" min="0" max="100" value="20">
                        </div>
                    </div>
                </div>

                <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ§Ï†ï -->
                <div class="category-section">
                    <div class="category-header">
                        <h3>üìö Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ§Ï†ï</h3>
                        <button type="button" class="add-category-btn" onclick="addCategory()">+ Ïπ¥ÌÖåÍ≥†Î¶¨ Ï∂îÍ∞Ä</button>
                    </div>
                    <div id="categoriesContainer">
                        <!-- Í∏∞Î≥∏ Ïπ¥ÌÖåÍ≥†Î¶¨ -->
                        <div class="category-item">
                            <div class="category-controls">
                <div class="form-group">
                    <label>Ïπ¥ÌÖåÍ≥†Î¶¨ (Ï§ëÎ≥µ ÏÑ†ÌÉù Í∞ÄÎä•)</label>
                                    <select class="category-select" required>
                                        <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                                        <option value="ÎèÖÌï¥">ÎèÖÌï¥</option>
                                        <option value="Î¨∏Î≤ï">Î¨∏Î≤ï</option>
                                        <option value="Ïñ¥Ìúò">Ïñ¥Ìúò</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>ÎπÑÏú® (%)</label>
                                    <input type="number" class="ratio-input" min="1" max="100" value="50" required>
                                </div>
                                <div class="form-group">
                                    <button type="button" class="add-category-btn" style="background: #dc3545;" onclick="removeCategory(this)">ÏÇ≠Ï†ú</button>
                                </div>
                            </div>
                            <div class="subcategory-group">
                                <label>ÏÑ∏Î∂Ä Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù</label>
                                <div class="subcategory-loading" style="display: none;">
                                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px;">
                                        <div style="width: 20px; height: 20px; border: 2px solid #f3f3f3; border-top: 2px solid #4facfe; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                                        <span>ÏÑ∏Î∂Ä Ïπ¥ÌÖåÍ≥†Î¶¨Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</span>
                                    </div>
                                </div>
                                <div class="subcategory-checkboxes" style="display: none;">
                                    <!-- Ï≤¥ÌÅ¨Î∞ïÏä§Îì§Ïù¥ ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê® -->
                                </div>
                                <div class="subcategory-placeholder">
                                    <p style="color: #666; font-style: italic; padding: 10px;">Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏÑ†ÌÉùÌïòÎ©¥ ÏÑ∏Î∂Ä Ïπ¥ÌÖåÍ≥†Î¶¨Í∞Ä ÌëúÏãúÎê©ÎãàÎã§.</p>
                                </div>
                                <div class="selected-subcategories">
                                    <span class="selected-count" style="display: none;">ÏÑ†ÌÉùÎê®: 0Í∞ú</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="generate-btn">üöÄ ÏòÅÏñ¥ Î¨∏Ï†ú ÏÉùÏÑ±ÌïòÍ∏∞</button>
            </form>

            <!-- Í≤∞Í≥º ÌëúÏãú ÏòÅÏó≠ -->
            <div class="result-section" id="resultSection">
                <div class="loading" id="loadingDiv">
                    <div class="spinner"></div>
                    <h3>AIÍ∞Ä ÎßûÏ∂§Ìòï ÏòÅÏñ¥ Î¨∏Ï†úÎ•º ÏÉùÏÑ±ÌïòÍ≥† ÏûàÏäµÎãàÎã§...</h3>
                    <p>Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî. ÏïΩ 1-2Î∂Ñ ÏÜåÏöîÎê©ÎãàÎã§.</p>
                </div>
                <div class="result-content" id="resultContent" style="display: none;">
                    <!-- Í≤∞Í≥ºÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // DBÏóêÏÑú Í∞ÄÏ†∏Ïò® ÏÑ∏Î∂Ä Ïπ¥ÌÖåÍ≥†Î¶¨ ÏòµÏÖò (Ïã§Ï†úÎ°úÎäî API Ìò∏Ï∂úÎ°ú Í∞ÄÏ†∏Ïò¥)
        const subcategoryOptions = {
            'ÎèÖÌï¥': [
                'Ï£ºÏ†ú/Ï†úÎ™© Ï∂îÎ°†', 'ÏöîÏßÄ/Ï£ºÏû• ÌååÏïÖ', 'ÏÑ∏Î∂ÄÏÇ¨Ìï≠ ÌååÏïÖ', 'ÎπàÏπ∏ Ï∂îÎ°†', 
                'Î¨∏Îã® ÏàúÏÑú', 'Î¨∏Ïû• ÏÇΩÏûÖ', 'ÎÇ¥Ïö© ÏùºÏπò/Î∂àÏùºÏπò', 'Í∏ÄÏùò Î∂ÑÏúÑÍ∏∞/Ïñ¥Ï°∞',
                'Ìï®Ï∂ï ÏùòÎØ∏ Ï∂îÎ°†', 'Ïó∞Í≤∞Ïñ¥Íµ¨ Ï∂îÎ°†', 'Î¨∏Îß•ÏÉÅ Ïñ¥Î≤ï'
            ],
            'Î¨∏Î≤ï': [
                'ÏãúÏ†ú', 'ÌÉú', 'Ï°∞ÎèôÏÇ¨', 'toÎ∂ÄÏ†ïÏÇ¨', 'ÎèôÎ™ÖÏÇ¨', 'Î∂ÑÏÇ¨', 
                'Í¥ÄÍ≥ÑÏÇ¨', 'Í∞ÄÏ†ïÎ≤ï', 'ÎπÑÍµêÍµ¨Î¨∏', 'Ï†ëÏÜçÏÇ¨', 'Ï†ÑÏπòÏÇ¨', 
                'ÌíàÏÇ¨ Î∞è Ïñ¥Î≤ï', 'ÎèÑÏπò', 'ÏÉùÎûµ', 'Í∞ïÏ°∞Íµ¨Î¨∏'
            ],
            'Ïñ¥Ìúò': [
                'Îã®Ïñ¥Ïùò ÏùòÎØ∏', 'Î¨∏Îß•ÏÉÅ Ï†ÅÏ†àÌïú Ïñ¥Ìúò', 'Ïñ¥Ìúò Ï∂îÎ°†', 
                'ÏàôÏñ¥/Í¥ÄÏö©ÌëúÌòÑ', 'Ïñ¥Í∑º/Ï†ëÏÇ¨', 'ÎèôÏùòÏñ¥/Î∞òÏùòÏñ¥',
                'Îã§ÏùòÏñ¥', 'ÌòïÌÉú Î≥ÄÌôî', 'Ïñ¥Ìúò Î∞∞Ïó¥'
            ]
        };

        // DB ÏãúÎÆ¨Î†àÏù¥ÏÖò - Ïã§Ï†úÎ°úÎäî Î∞±ÏóîÎìú API Ìò∏Ï∂ú
        async function fetchSubcategoriesFromDB(category) {
            // Ïã§Ï†ú Íµ¨ÌòÑÏóêÏÑúÎäî Ïù¥ Î∂ÄÎ∂ÑÏù¥ API Ìò∏Ï∂ú
            // const response = await fetch(`/api/subcategories/${category}`);
            // return await response.json();
            
            // ÏãúÎÆ¨Î†àÏù¥ÏÖò: ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ ÌõÑ Îç∞Ïù¥ÌÑ∞ Î∞òÌôò
            return new Promise(resolve => {
                setTimeout(() => {
                    resolve(subcategoryOptions[category] || []);
                }, 300);
            });
        }

        // ÎÇúÏù¥ÎèÑ ÏÑ†ÌÉù Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏
        document.getElementById('difficulty').addEventListener('change', function() {
            const difficultyDistribution = document.getElementById('difficultyDistribution');
            if (this.value === 'Î∂ÑÎ∞∞') {
                difficultyDistribution.style.display = 'block';
            } else {
                difficultyDistribution.style.display = 'none';
            }
        });

        // Ïπ¥ÌÖåÍ≥†Î¶¨ Ï∂îÍ∞Ä Ìï®Ïàò
        function addCategory() {
            const container = document.getElementById('categoriesContainer');
            const categoryItem = document.createElement('div');
            categoryItem.className = 'category-item';
            categoryItem.innerHTML = `
                <div class="category-controls">
                    <div class="form-group">
                        <label>Ïπ¥ÌÖåÍ≥†Î¶¨ (Ï§ëÎ≥µ ÏÑ†ÌÉù Í∞ÄÎä•)</label>
                        <select class="category-select" required>
                            <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                            <option value="ÎèÖÌï¥">ÎèÖÌï¥</option>
                            <option value="Î¨∏Î≤ï">Î¨∏Î≤ï</option>
                            <option value="Ïñ¥Ìúò">Ïñ¥Ìúò</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ÎπÑÏú® (%)</label>
                        <input type="number" class="ratio-input" min="1" max="100" value="30" required>
                    </div>
                    <div class="form-group">
                        <button type="button" class="add-category-btn" style="background: #dc3545;" onclick="removeCategory(this)">ÏÇ≠Ï†ú</button>
                    </div>
                </div>
                <div class="subcategory-group">
                    <label>ÏÑ∏Î∂Ä Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù</label>
                    <div class="subcategory-loading" style="display: none;">
                        <div style="display: flex; align-items: center; gap: 10px; padding: 10px;">
                            <div style="width: 20px; height: 20px; border: 2px solid #f3f3f3; border-top: 2px solid #4facfe; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                            <span>ÏÑ∏Î∂Ä Ïπ¥ÌÖåÍ≥†Î¶¨Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</span>
                        </div>
                    </div>
                    <div class="subcategory-checkboxes" style="display: none;">
                        <!-- Ï≤¥ÌÅ¨Î∞ïÏä§Îì§Ïù¥ ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê® -->
                    </div>
                    <div class="subcategory-placeholder">
                        <p style="color: #666; font-style: italic; padding: 10px;">Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏÑ†ÌÉùÌïòÎ©¥ ÏÑ∏Î∂Ä Ïπ¥ÌÖåÍ≥†Î¶¨Í∞Ä ÌëúÏãúÎê©ÎãàÎã§.</p>
                    </div>
                    <div class="selected-subcategories">
                        <span class="selected-count" style="display: none;">ÏÑ†ÌÉùÎê®: 0Í∞ú</span>
                    </div>
                </div>
            `;
            container.appendChild(categoryItem);
            setupCategoryEvents(categoryItem);
        }

        // Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÇ≠Ï†ú Ìï®Ïàò
        function removeCategory(button) {
            button.closest('.category-item').remove();
        }

        // Ïπ¥ÌÖåÍ≥†Î¶¨ Ïù¥Î≤§Ìä∏ ÏÑ§Ï†ï
        function setupCategoryEvents(categoryItem) {
            const categorySelect = categoryItem.querySelector('.category-select');
            const subcategoryLoading = categoryItem.querySelector('.subcategory-loading');
            const subcategoryCheckboxes = categoryItem.querySelector('.subcategory-checkboxes');
            const subcategoryPlaceholder = categoryItem.querySelector('.subcategory-placeholder');
            const selectedCount = categoryItem.querySelector('.selected-count');

            // Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù Î≥ÄÍ≤Ω Ïãú DBÏóêÏÑú ÏÑ∏Î∂Ä Ïπ¥ÌÖåÍ≥†Î¶¨ Î°úÎìú
            categorySelect.addEventListener('change', async function() {
                const category = this.value;
                
                if (!category) {
                    // Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù Ìï¥Ï†ú
                    subcategoryCheckboxes.style.display = 'none';
                    subcategoryPlaceholder.style.display = 'block';
                    selectedCount.style.display = 'none';
                    return;
                }

                // Î°úÎî© ÌëúÏãú
                subcategoryPlaceholder.style.display = 'none';
                subcategoryLoading.style.display = 'block';
                subcategoryCheckboxes.style.display = 'none';

                try {
                    // DBÏóêÏÑú ÏÑ∏Î∂Ä Ïπ¥ÌÖåÍ≥†Î¶¨ Í∞ÄÏ†∏Ïò§Í∏∞
                    const subcategories = await fetchSubcategoriesFromDB(category);
                    
                    // Ï≤¥ÌÅ¨Î∞ïÏä§ ÏÉùÏÑ±
                    createSubcategoryCheckboxes(subcategoryCheckboxes, subcategories, selectedCount);
                    
                    // Î°úÎî© Ïà®Í∏∞Í≥† Ï≤¥ÌÅ¨Î∞ïÏä§ ÌëúÏãú
                    subcategoryLoading.style.display = 'none';
                    subcategoryCheckboxes.style.display = 'grid';
                    selectedCount.style.display = 'inline-block';
                    
                } catch (error) {
                    console.error('ÏÑ∏Î∂Ä Ïπ¥ÌÖåÍ≥†Î¶¨ Î°úÎìú Ïã§Ìå®:', error);
                    subcategoryLoading.style.display = 'none';
                    subcategoryPlaceholder.innerHTML = '<p style="color: #dc3545;">ÏÑ∏Î∂Ä Ïπ¥ÌÖåÍ≥†Î¶¨Î•º Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.</p>';
                    subcategoryPlaceholder.style.display = 'block';
                }
            });
        }

        // ÏÑ∏Î∂Ä Ïπ¥ÌÖåÍ≥†Î¶¨ Ï≤¥ÌÅ¨Î∞ïÏä§ ÏÉùÏÑ±
        function createSubcategoryCheckboxes(container, subcategories, selectedCount) {
            container.innerHTML = '';
            
            subcategories.forEach((subcategory, index) => {
                const checkboxItem = document.createElement('div');
                checkboxItem.className = 'subcategory-checkbox-item';
                
                const checkboxId = `subcategory_${Date.now()}_${index}`;
                
                checkboxItem.innerHTML = `
                    <input type="checkbox" id="${checkboxId}" class="subcategory-checkbox" value="${subcategory}">
                    <label for="${checkboxId}" class="subcategory-label">${subcategory}</label>
                `;
                
                container.appendChild(checkboxItem);
                
                // Ï≤¥ÌÅ¨Î∞ïÏä§ Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏
                const checkbox = checkboxItem.querySelector('.subcategory-checkbox');
                checkbox.addEventListener('change', function() {
                    updateSelectedCount(container.closest('.category-item'));
                });
            });
            
            updateSelectedCount(container.closest('.category-item'));
        }

        // ÏÑ†ÌÉùÎêú ÏÑ∏Î∂Ä Ïπ¥ÌÖåÍ≥†Î¶¨ Ïàò ÏóÖÎç∞Ïù¥Ìä∏
        function updateSelectedCount(categoryItem) {
            const checkboxes = categoryItem.querySelectorAll('.subcategory-checkbox');
            const selectedCheckboxes = categoryItem.querySelectorAll('.subcategory-checkbox:checked');
            const selectedCount = categoryItem.querySelector('.selected-count');
            
            const count = selectedCheckboxes.length;
            selectedCount.textContent = `ÏÑ†ÌÉùÎê®: ${count}Í∞ú`;
            selectedCount.style.backgroundColor = count > 0 ? '#28a745' : '#6c757d';
        }

        // ÏÑ†ÌÉùÎêú ÏÑ∏Î∂Ä Ïπ¥ÌÖåÍ≥†Î¶¨ Í∞ÄÏ†∏Ïò§Í∏∞
        function getSelectedSubcategories(categoryItem) {
            const selectedCheckboxes = categoryItem.querySelectorAll('.subcategory-checkbox:checked');
            return Array.from(selectedCheckboxes).map(cb => cb.value);
        }

        // Ï¥àÍ∏∞ Ïπ¥ÌÖåÍ≥†Î¶¨ Ïù¥Î≤§Ìä∏ ÏÑ§Ï†ï
        document.querySelectorAll('.category-item').forEach(setupCategoryEvents);

        // Ìèº Ï†úÏ∂ú Ïù¥Î≤§Ìä∏
        document.getElementById('contentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Ìèº Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
            const formData = collectFormData();
            
            if (formData) {
                // Í≤∞Í≥º ÏÑπÏÖò ÌëúÏãú
                document.getElementById('resultSection').style.display = 'block';
                document.getElementById('loadingDiv').style.display = 'block';
                document.getElementById('resultContent').style.display = 'none';
                
                // Ïä§ÌÅ¨Î°§ Ïù¥Îèô
                document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
                
                // Ïã§Ï†úÎ°úÎäî ÏÑúÎ≤ÑÏóê ÏöîÏ≤≠ÏùÑ Î≥¥ÎÇ¥Ïïº ÌïòÏßÄÎßå, Ïó¨Í∏∞ÏÑúÎäî ÏãúÎÆ¨Î†àÏù¥ÏÖò
                simulateGeneration(formData);
            }
        });

        // Ìèº Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
        function collectFormData() {
            const categories = [];
            const categoryItems = document.querySelectorAll('.category-item');
            
            let totalRatio = 0;
            
            for (let item of categoryItems) {
                const categorySelect = item.querySelector('.category-select');
                const ratioInput = item.querySelector('.ratio-input');
                
                if (!categorySelect.value) {
                    alert('Î™®Îì† Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return null;
                }
                
                // ÏÑ†ÌÉùÎêú ÏÑ∏Î∂Ä Ïπ¥ÌÖåÍ≥†Î¶¨ Í∞ÄÏ†∏Ïò§Í∏∞
                const selectedSubcategories = getSelectedSubcategories(item);
                
                if (selectedSubcategories.length === 0) {
                    alert(`${categorySelect.value} Ïπ¥ÌÖåÍ≥†Î¶¨Ïóê ÏµúÏÜå 1Í∞úÏùò ÏÑ∏Î∂Ä Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.`);
                    return null;
                }
                
                const ratio = parseInt(ratioInput.value);
                totalRatio += ratio;
                
                categories.push({
                    name: categorySelect.value,
                    subcategories: selectedSubcategories,
                    ratio: ratio
                });
            }
            
            if (totalRatio !== 100) {
                alert(`Ïπ¥ÌÖåÍ≥†Î¶¨ ÎπÑÏú®Ïùò Ìï©Ïù¥ 100%Í∞Ä ÎêòÏñ¥Ïïº Ìï©ÎãàÎã§. (ÌòÑÏû¨: ${totalRatio}%)`);
                return null;
            }
            
            const formData = {
                grade: parseInt(document.getElementById('grade').value),
                categories: categories,
                question_type: document.getElementById('questionType').value,
                difficulty: document.getElementById('difficulty').value,
                total_questions: parseInt(document.getElementById('totalQuestions').value)
            };
            
            if (formData.difficulty === 'Î∂ÑÎ∞∞') {
                const high = parseInt(document.getElementById('diffHigh').value);
                const medium = parseInt(document.getElementById('diffMedium').value);
                const low = parseInt(document.getElementById('diffLow').value);
                
                if (high + medium + low !== 100) {
                    alert(`ÎÇúÏù¥ÎèÑ Î∂ÑÎ∞∞Ïùò Ìï©Ïù¥ 100%Í∞Ä ÎêòÏñ¥Ïïº Ìï©ÎãàÎã§. (ÌòÑÏû¨: ${high + medium + low}%)`);
                    return null;
                }
                
                formData.difficulty_distribution = {
                    high: high,
                    medium: medium,
                    low: low
                };
            }
            
            return formData;
        }

        // ÏÉùÏÑ± ÏãúÎÆ¨Î†àÏù¥ÏÖò (Ïã§Ï†úÎ°úÎäî ÏÑúÎ≤Ñ API Ìò∏Ï∂ú)
        function simulateGeneration(formData) {
            console.log('Generated request data:', formData);
            
            // ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏßÄÏó∞
            setTimeout(() => {
                document.getElementById('loadingDiv').style.display = 'none';
                document.getElementById('resultContent').style.display = 'block';
                
                // Í≤∞Í≥º ÌëúÏãú
                displayResults(formData);
            }, 3000);
        }

        // Í≤∞Í≥º ÌëúÏãú
        function displayResults(formData) {
            const resultContent = document.getElementById('resultContent');
            
            resultContent.innerHTML = `
                <div class="result-item">
                    <div class="result-title">üìã ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞</div>
                    <div class="json-display">${JSON.stringify(formData, null, 2)}</div>
                </div>
                
                <div class="result-item">
                    <div class="result-title">üìä Î¨∏Ìï≠ Î∂ÑÎ∞∞ Í≥ÑÌöç</div>
                    <div class="json-display">${generateDistributionPlan(formData)}</div>
                </div>
                
                <div class="result-item">
                    <div class="result-title">üöÄ ÏÉùÏÑ± ÏÉÅÌÉú</div>
                    <p>‚úÖ ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞ Í≤ÄÏ¶ù ÏôÑÎ£å</p>
                    <p>‚úÖ Î¨∏Ìï≠ Î∂ÑÎ∞∞ Í≥ÑÌöç ÏàòÎ¶Ω ÏôÑÎ£å</p>
                    <p>‚è≥ Ïã§Ï†ú ÏΩòÌÖêÏ∏† ÏÉùÏÑ±ÏùÑ ÏúÑÌï¥ÏÑúÎäî Python Î∞±ÏóîÎìú ÏÑúÎ≤ÑÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.</p>
                    <p>üí° Ïù¥ HTMLÏùÄ ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞Î•º ÌÖåÏä§Ìä∏ÌïòÍ∏∞ ÏúÑÌïú ÌîÑÎ°†Ìä∏ÏóîÎìú Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ÏûÖÎãàÎã§.</p>
                </div>
            `;
        }

        // Î∂ÑÎ∞∞ Í≥ÑÌöç ÏÉùÏÑ±
        function generateDistributionPlan(formData) {
            let plan = "Î¨∏Ìï≠ Î∂ÑÎ∞∞ Í≥ÑÌöç:\n\n";
            
            const totalRatio = formData.categories.reduce((sum, cat) => sum + cat.ratio, 0);
            
            formData.categories.forEach(category => {
                const categoryQuestions = Math.floor(formData.total_questions * category.ratio / totalRatio);
                const subcategoryQuestions = Math.floor(categoryQuestions / category.subcategories.length);
                
                plan += `${category.name} (${category.ratio}%): ${categoryQuestions}Î¨∏Ìï≠\n`;
                
                category.subcategories.forEach(sub => {
                    plan += `  ‚îî ${sub}: ${subcategoryQuestions}Î¨∏Ìï≠\n`;
                });
                
                plan += "\n";
            });
            
            if (formData.difficulty === 'Î∂ÑÎ∞∞') {
                plan += "ÎÇúÏù¥ÎèÑ Î∂ÑÎ∞∞:\n";
                plan += `  ÏÉÅ: ${formData.difficulty_distribution.high}%\n`;
                plan += `  Ï§ë: ${formData.difficulty_distribution.medium}%\n`;
                plan += `  Ìïò: ${formData.difficulty_distribution.low}%\n`;
            }
            
            return plan;
        }
    </script>
</body>
</html>
